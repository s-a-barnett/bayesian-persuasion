<!DOCTYPE html>
<html>
    <head>
        <title>Experiment 1</title>
        <script src="jspsych-6.1.0/jspsych.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-html-keyboard-response.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-html-slider-response.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-image-slider-response.js"></script>
        <link href="jspsych-6.1.0/css/jspsych.css" rel="stylesheet" type="text/css"></link>
    </head>
    <body></body>
    <script>

    var timeline = [];

    var welcome = {
        type: 'html-keyboard-response',
        stimulus: 'Welcome to the experiment. Press any key to begin.'
    }

    timeline.push(welcome);

    // Values fixed for human experiments.
    var numSticks = 5
    var agentBias = 10
    var max_stimulus_height = 300

    // TODO: Replace with input from MongoDB
    // agent1stick \in \{ 0.6, 0.7, ..., 1.0\}
    // agent2stick \in \{ 0.1, 0.2, ..., 0.5\}
    var agent1stick = 0.7
    var agent2stick = 0.4


    var instructions = {
      type: "html-keyboard-response",
      stimulus: "<p> Two players are shown a sample of " +
      numSticks +
      " sticks drawn uniformly between 0 and 1, and each will take one turn " +
      "to show you a stick from this sample. </p>" +
      "<p> You must assess your degree of confidence that " +
      "the sample is 'long', i.e. that " +
      "the mean stick length of the sample is at least 0.5. </p>" +
      "Player 1 will be paid $" + agentBias + " if your confidence that the " +
      "sample is long is at least 5 after the two turns. Otherwise, Player 2 " +
      "will be paid $" + agentBias + ".</p>" +
      "<p> After each move, you must also assess your degree of belief that " +
      "the player is biased towards showing you longer or shorter sticks. " +
      "<p>Press any key to begin.</p>"
    };

    timeline.push(instructions);

    // Add example with 5 sticks. Display mean and stick lengths. Show stick
    // choices for each.

    // Make the choices feel more realistic by adding arbitrary delay.
    var pre_first_move = {
        type: "html-keyboard-response",
        stimulus: "<p> Player 1 choosing move... </p>",
        choices: jsPsych.NO_KEYS,
        trial_duration: jsPsych.randomization.sampleWithReplacement([3000, 4000, 5000], 1)[0]
    }

    timeline.push(pre_first_move);

    var first_move = {
        type: "image-slider-response",
        stimulus: 'figures/stick.jpg',
        stimulus_height: agent1stick * max_stimulus_height,
        prompt: "<p> Player 1 shows a stick of length " + agent1stick +
        " from the sample.</p>" +
        "<p> Assess your confidence that the overall sample is long.</p>",
        labels: ['Definitely short.', 'Definitely long.'],
        require_movement: true
    }

    timeline.push(first_move);

    // Allows us to measure the strong evidence effect for listeners.
    var post_first_move = {
        type: "html-slider-response",
        stimulus: "<p> How biased is Player 1? </p>",
        labels: ['Biased towards showing shorter sticks.',
                 'Showing sticks at random.',
                 'Biased towards showing longer sticks.'],
                 require_movement: true
    }

    timeline.push(post_first_move);

    // Make the choices feel more realistic by adding arbitrary delay.
    var pre_second_move = {
        type: "html-keyboard-response",
        stimulus: "<p> Player 2 choosing move... </p>",
        choices: jsPsych.NO_KEYS,
        trial_duration: jsPsych.randomization.sampleWithReplacement([3000, 4000, 5000], 1)[0]
    }

    timeline.push(pre_second_move);

    var second_move = {
        type: "html-slider-response",
        stimulus: "<p> Player 1 shows a stick of length " + agent1stick +
        " from the sample, and then Player 2 shows a stick of length " +
        agent2stick + " from the sample.</p>" +
        "<p> Assess your confidence that the overall sample is long.</p>",
        labels: ['Definitely short.', 'Definitely long.'],
        require_movement: true
    }

    timeline.push(second_move);

    // Allows us to measure the strong evidence effect for listeners.
    var post_second_move = {
        type: "html-slider-response",
        stimulus: "<p> How biased is Player 2? </p>",
        labels: ['Biased towards showing shorter sticks.',
                 'Showing sticks at random.',
                 'Biased towards showing longer sticks.'],
                 require_movement: true
    }

    timeline.push(post_second_move);

    var goodbye = {
        type: 'html-keyboard-response',
        stimulus: 'Thank you for participating! Press any key to exit.'
    }

    timeline.push(goodbye);

    // Store experiment parameter settings in the data.
    jsPsych.data.addProperties({
        numSticks: numSticks,
        agentBias: agentBias,
        agent1stick: agent1stick,
        agent2stick: agent2stick
    });

    jsPsych.init({
      timeline: timeline,
      on_finish: function() {
        jsPsych.data.displayData();
      }
    });
    </script>
</html>
