<!DOCTYPE html>
<html>
    <head>
        <title>Experiment 1</title>
        <script src="jspsych-6.1.0/jspsych.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-html-keyboard-response.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-html-slider-response.js"></script>
        <link href="jspsych-6.1.0/css/jspsych.css" rel="stylesheet" type="text/css"></link>
    </head>
    <body></body>
    <script>

    var timeline = [];

    var welcome = {
        type: 'html-keyboard-response',
        stimulus: 'Welcome to the experiment. Press any key to begin.'
    }

    timeline.push(welcome);

    // Parameters to vary for each experiment. Is there a better way to do this
    // with timeline variables?
    var numSticks = jsPsych.randomization.sampleWithReplacement([3,4,5,6,7], 1)[0]
    var agent1bias = jsPsych.randomization.sampleWithReplacement([0, 1, 5], 1)[0]
    var agent2bias = jsPsych.randomization.sampleWithReplacement([0, 1, 5], 1)[0]
    var agent1stick = jsPsych.randomization.sampleWithReplacement([0.8, 0.9, 1.0], 1)[0]
    var agent2stick = jsPsych.randomization.sampleWithReplacement([0.4, 0.3], 1)[0]


    var instructions = {
      type: "html-keyboard-response",
      stimulus: "<p> Two players are shown a sample of " +
      numSticks +
      " sticks drawn uniformly between 0 and 1, and each will take one turn " +
      "to show you a stick from this sample. </p>" +
      "<p> You must assess your degree of confidence that " +
      "the sample is 'long', i.e. that " +
      "the mean stick length of the sample is at least 0.5. </p>" +
      "Player 1 will be paid $" + agent1bias + " if your confidence that the " +
      "sample is long is at least 5 after the two turns. Otherwise, Player 2 " +
      "will be paid $" + agent2bias + ".</p>" +
      "<p> After each move, you must also assess your degree of belief that " +
      "the player is biased towards showing you longer or shorter sticks. " +
      "<p>Press any key to begin.</p>"
    };

    timeline.push(instructions);

    var pre_first_move = {
        type: "html-keyboard-response",
        stimulus: "<p> Player 1 choosing move... </p>",
        choices: jsPsych.NO_KEYS,
        trial_duration: jsPsych.randomization.sampleWithReplacement([3000, 4000, 5000], 1)[0]
    }

    timeline.push(pre_first_move);

    var first_move = {
        type: "html-slider-response",
        stimulus: "<p> Player 1 shows a stick of length " + agent1stick +
        " from the sample.</p>" +
        "<p> Assess your confidence that the overall sample is long.</p>",
        labels: ['Definitely short.', 'Definitely long.'],
        max: 21
    }

    timeline.push(first_move);

    var post_first_move = {
        type: "html-slider-response",
        stimulus: "<p> How biased is Player 1? </p>",
        labels: ['Biased towards showing shorter sticks.',
                 'Showing sticks at random.',
                 'Biased towards showing longer sticks.'],
        min: -10,
        max: 10
    }

    timeline.push(post_first_move);

    var pre_second_move = {
        type: "html-keyboard-response",
        stimulus: "<p> Player 2 choosing move... </p>",
        choices: jsPsych.NO_KEYS,
        trial_duration: jsPsych.randomization.sampleWithReplacement([3000, 4000, 5000], 1)[0]
    }

    timeline.push(pre_second_move);

    var second_move = {
        type: "html-slider-response",
        stimulus: "<p> Player 1 shows a stick of length " + agent1stick +
        " from the sample, and then Player 2 shows a stick of length " +
        agent2stick + " from the sample.</p>" +
        "<p> Assess your confidence that the overall sample is long.</p>",
        labels: ['Definitely short.', 'Definitely long.'],
        max: 21
    }

    timeline.push(second_move);

    var post_second_move = {
        type: "html-slider-response",
        stimulus: "<p> How biased is Player 2? </p>",
        labels: ['Biased towards showing shorter sticks.',
                 'Showing sticks at random.',
                 'Biased towards showing longer sticks.'],
        min: -10,
        max: 10
    }

    timeline.push(post_second_move);

    var goodbye = {
        type: 'html-keyboard-response',
        stimulus: 'Thank you for participating! Press any key to exit.'
    }

    timeline.push(goodbye);

    // Store experiment parameter settings in the data.
    jsPsych.data.addProperties({
        numSticks: numSticks,
        agent1bias: agent1bias,
        agent2bias: agent2bias,
        agent1stick: agent1stick,
        agent2stick: agent2stick
    });

    jsPsych.init({
      timeline: timeline,
      on_finish: function() {
        jsPsych.data.displayData();
      }
    });
    </script>
</html>
